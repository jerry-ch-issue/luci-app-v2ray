/**
 * @license
 * Copyright 2020 Xingwang Liao <kuoruan@gmail.com>
 *
 * Licensed to the public under the MIT License.
 */
"use strict";"require form";"require v2ray";"require uci";return L.view.extend({load:function(){return Promise.all([v2ray.getSections("dns_server"),v2ray.getCore(),v2ray.getSections("host_mapping")])},render:function(e){var a,o=void 0===e?[]:e,r=o[0],t=void 0===r?[]:r,i=o[1],l=void 0===i?"":i,n=o[2],s=void 0===n?[]:n,d=new form.Map("v2ray","%s - %s".format(l,_("DNS")),_("Details: %s").format('<a href="https://xtls.github.io/en/config/dns.html#dnsobject" target="_blank">DnsObject</a>')),u=d.section(form.NamedSection,"main_dns","dns");u.anonymous=!0,u.addremove=!1,(a=u.option(form.Flag,"enabled",_("Enabled"))).rmempty=!1,(a=u.option(form.Value,"tag",_("Tag"))).rmempty=!1,(a=u.option(form.Value,"client_ip",_("Client IP"),'<a href="https://icanhazip.com" target="_blank">%s</a>'.format(_("Get my public IP address")))).datatype="ipaddr",(a=u.option(form.ListValue,"query_strategy",_("Domain Strategy"))).value("UseIP"),a.value("UseIPv4"),a.value("UseIPv6"),(a=u.option(form.ListValue,"disable_cache",_("Disable DNS Cache"))).value("0",_("False")),a.value("1",_("True")),(a=u.option(form.ListValue,"disable_fallback",_("Disable Fallback Query"))).value("0",_("False")),a.value("1",_("True")),(a=u.option(form.ListValue,"disable_fallback_if_match",_("Disable Fallback if got Matches"))).value("0",_("False")),a.value("1",_("True")),a=u.option(form.MultiValue,"servers",_("DNS Servers"));for(var m=0,p=t;m<p.length;m++){var v=p[m];a.value(v.value,v.caption)}a=u.option(form.MultiValue,"host_override",_("Host Mappings"));for(var c=0,y=s;c<y.length;c++){var f=y[c];a.value(f.value,f.caption)}var b=d.section(form.GridSection,"dns_server",_("DNS server"),_("Add DNS servers here"));b.sectiontitle=function(e){return uci.get("v2ray",e,"alias")},b.modaltitle=function(e){var a=uci.get("v2ray",e,"alias");return _("DNS server")+" > "+(null!=a?a:_("Add"))},b.addremove=!0,b.nodescription=!0,b.sortable=!0,(a=b.option(form.Value,"alias",_("Alias"))).rmempty=!1,a.modalonly=!0,(a=b.option(form.ListValue,"dns_server_type",_("Type"))).value("DoH"),a.value("fakedns"),a.value("localhost"),a.value("QUIC"),a.value("TCP"),a.value("UDP"),(a=b.option(form.ListValue,"doh_provider","DoH Provider")).modalonly=!0,a.depends("dns_server_type","DoH"),a.value("8.8.8.8","Google"),a.value("1.1.1.1","Cloudflare"),a.value("dns.adguard-dns.com","adGuard"),(a=b.option(form.Value,"address",_("Address"))).datatype="host",a.depends({dns_server_type:/\b(QUIC|TCP|UDP)\b/i}),(a=b.option(form.Value,"port",_("Port"))).depends({dns_server_type:/\b(QUIC|TCP|UDP)\b/i}),a.modalonly=!0,a.datatype="port",a.placeholder="53",(a=b.option(form.Flag,"local_mode",_("Local Mode"),_("DNS Query through <code>Freedom</code> outbound"))).modalonly=!0,a.depends({dns_server_type:/\b(DoH|TCP|QUIC)\b/i}),(a=b.option(form.DynamicList,"domains",_("Domains"))).validate=function(e,a){return!a||v2ray.v2rayValidation("domainrule",a)},a.modalonly=!0,(a=b.option(form.DynamicList,"expect_ips",_("Expect IPs"))).validate=function(e,a){return!a||v2ray.v2rayValidation("iprule",a)},a.modalonly=!0,(a=b.option(form.ListValue,"skip_fallback",_("Skip Fallback"))).modalonly=!0,a.value(""),a.value("0",_("False")),a.value("1",_("True")),(a=b.option(form.Value,"client_ip",_("Client IP"))).modalonly=!0,a.datatype="ipaddr";var g=d.section(form.GridSection,"host_mapping",_("Host Mapping"),_("Add host mappings here"));return g.sectiontitle=function(e){return uci.get("v2ray",e,"alias")},g.modaltitle=function(e){var a=uci.get("v2ray",e,"alias");return _("Host Mappings")+" > "+(null!=a?a:_("Add"))},g.addremove=!0,g.nodescription=!0,g.sortable=!0,(a=g.option(form.Value,"alias",_("Alias"))).rmempty=!1,a.modalonly=!0,(a=g.option(form.Value,"host_domain",_("Domain"))).rmempty=!1,a.validate=function(e,a){return!a||v2ray.v2rayValidation("domainrule",a)},(a=g.option(form.DynamicList,"host_ip",_("Host or IP Addresses"))).modalonly=!0,a.rmempty=!1,a.datatype="host",d.render()}});