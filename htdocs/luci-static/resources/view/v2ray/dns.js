/**
 * @license
 * Copyright 2020 Xingwang Liao <kuoruan@gmail.com>
 *
 * Licensed to the public under the MIT License.
 */
"use strict";"require form";"require v2ray";"require uci";return L.view.extend({load:function(){return Promise.all([v2ray.getSections("dns_server"),v2ray.getCore()])},render:function(e){var a,o=void 0===e?[]:e,r=o[0],t=void 0===r?[]:r,l=o[1],i=void 0===l?"":l,n=new form.Map("v2ray","%s - %s".format(i,_("DNS")),_("Details: %s").format('<a href="https://xtls.github.io/en/config/dns.html#dnsobject" target="_blank">DnsObject</a>')),d=n.section(form.NamedSection,"main_dns","dns");d.anonymous=!0,d.addremove=!1,(a=d.option(form.Flag,"enabled",_("Enabled"))).rmempty=!1,(a=d.option(form.Value,"tag",_("Tag"))).rmempty=!1,(a=d.option(form.Value,"client_ip",_("Client IP"),'<a href="https://icanhazip.com" target="_blank">%s</a>'.format(_("Get my public IP address")))).datatype="ipaddr",(a=d.option(form.DynamicList,"hosts",_("Hosts"),_("Host and domain mapping</br>format: <code>domain|ip1,ip2</code> or <code>domain-A|domain-B</code> eg: </br>%s or %s").format("<code>dns.google|8.8.8.8,8.8.4.4</code>","<code>google.cn|google.com</code>"))).validate=function(e,a){return!a||v2ray.v2rayValidation("hostmapping",a)},a.rmempty=!0,(a=d.option(form.ListValue,"query_strategy",_("Domain Strategy"))).value("UseIP"),a.value("UseIPv4"),a.value("UseIPv6"),(a=d.option(form.ListValue,"disable_cache",_("Disable DNS Cache"))).value("0",_("False")),a.value("1",_("True")),(a=d.option(form.ListValue,"disable_fallback",_("Disable Fallback Query"))).value("0",_("False")),a.value("1",_("True")),(a=d.option(form.ListValue,"disable_fallback_if_match",_("Disable Fallback if got Matches"))).value("0",_("False")),a.value("1",_("True")),a=d.option(form.MultiValue,"servers",_("DNS Servers"));for(var s=0,u=t;s<u.length;s++){var m=u[s];a.value(m.value,m.caption)}var v=n.section(form.GridSection,"dns_server",_("DNS server"),_("Add DNS servers here"));return v.sectiontitle=function(e){return uci.get("v2ray",e,"alias")},v.modaltitle=function(e){var a=uci.get("v2ray",e,"alias");return _("DNS server")+" > "+(null!=a?a:_("Add"))},v.addremove=!0,v.nodescription=!0,v.sortable=!0,(a=v.option(form.Value,"alias",_("Alias"))).rmempty=!1,a.modalonly=!0,(a=v.option(form.ListValue,"dns_server_type",_("Type"))).value("DoH"),a.value("fakedns"),a.value("localhost"),a.value("QUIC"),a.value("TCP"),a.value("UDP"),(a=v.option(form.ListValue,"doh_provider","DoH Provider")).modalonly=!0,a.depends("dns_server_type","DoH"),a.value("8.8.8.8","Google"),a.value("1.1.1.1","Cloudflare"),a.value("dns.adguard-dns.com","adGuard"),(a=v.option(form.Value,"address",_("Address"))).datatype="host",a.depends({dns_server_type:/\b(QUIC|TCP|UDP)\b/i}),(a=v.option(form.Value,"port",_("Port"))).depends({dns_server_type:/\b(QUIC|TCP|UDP)\b/i}),a.modalonly=!0,a.datatype="port",a.placeholder="53",(a=v.option(form.Flag,"local_mode",_("Local Mode"),_("DNS Query through <code>Freedom</code> outbound"))).modalonly=!0,a.depends({dns_server_type:/\b(DoH|TCP|QUIC)\b/i}),(a=v.option(form.DynamicList,"domains",_("Domains"))).validate=function(e,a){return!a||v2ray.v2rayValidation("domainrule",a)},a.modalonly=!0,(a=v.option(form.DynamicList,"expect_ips",_("Expect IPs"))).validate=function(e,a){return!a||v2ray.v2rayValidation("iprule",a)},a.modalonly=!0,(a=v.option(form.ListValue,"skip_fallback",_("Skip Fallback"))).modalonly=!0,a.value(""),a.value("0",_("False")),a.value("1",_("True")),(a=v.option(form.Value,"client_ip",_("Client IP"))).modalonly=!0,a.datatype="ipaddr",n.render()}});